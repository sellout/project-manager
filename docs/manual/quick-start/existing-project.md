# Integrate With an Existing Project {#sec-existing-project}

**WARNING**: `project-manager switch` (but no other subcommands) may overwrite files that already exist in your working tree. You should ensure that everything is committed or stashed before integrating Project Manager with an existing project.

Start by creating a basic project configuration by running this from within your project directory:

```bash
nix run github:sellout/project-manager
```

Note that this is similar to the command used by a new project. The differences are that

1. we’re not providing a directory for it to create, so it will use the current directory and
2. we are not providing `--switch` to avoid it immediately creating the new configuration.

If your project is already flake-based, this will _not_ overwrite the existing flake, so you will need to modify your flake to provide Project Manager integration.

At a minimum, you need to have

```nix
{
  outputs = {nixpkgs, project-manager, self}: let
    system = "x86_64-linux"; # or another system
    pkgs = import nixpkgs {inherit system};
  in {
    projectConfigurations.${system} =
      project-manager.lib.defaultConfiguration {inherit pkgs self};
  }

  inputs = {
    # NB: This version doesn’t have to be current, Project Manager supports many
    #     older Nixpkgs releases as well as unstable (as much as is possible).
    nixpkgs.url = "github:NixOS/nixpkgs/release-24.05";
    project-manager.url = "github:sellout/project-manager";
  }
}
```

But project manager offers many attributes to integrate with other parts of your flake. For example., you may also include

```nix
{
  outputs = {nixpkgs, project-manager, self}: let
    system = "x86_64-linux"; # or another system
    pkgs = import nixpkgs {inherit system};
  in {
    # …

    devShells.${system} = let
        self.projectConfigurations.${system}.devShells
        // {
          # You can user `overrideAttrs` on this to extend this shell.
          default =
            self.projectConfigurations.${system}.devShells.project-manager;
        };

      checks.${system} =
        # This provides a check that files generated by Project Manager are
        # up-to-date, as well as checks for other modules you may have
        # configured (a formatter, linters, etc.)
        self.projectConfigurations.${system}.checks
        // {
          # Any additional checks
        }

      # If your formatter is configured by Project Manager, which is especially
      # useful when using meta-formatters like treefmt-nix.
      # (https://github.com/numtide/treefmt-nix#readme)
      formatter.${system} = self.projectConfigurations.${system}.formatter;
}
```

If you have all of your non-Project Manager related changes stashed, you can see how the default configuration affects your project by running

```nix
nix run github:sellout/project-manager -- switch
```

You can now see what changes are reflected in your VCS. The most important thing is to check for modified files. For anything that has been modified you can either disable that module in .config/project/default.nix or adjust the [configuration](#ch-options) there to match what exists in your repository.

Other files may have also been created. You can similarly disable these modules if you want to.
